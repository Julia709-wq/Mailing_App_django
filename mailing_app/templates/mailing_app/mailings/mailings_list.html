{% extends 'mailing_app/base.html' %}

{% block title %}Список рассылок{% endblock %}

{% block content %}
<div class="recipients-container">
    <h1 class="recipients-title">Список рассылок</h1>
    <div class="add-recipient-container">
        <a href="{% url 'mailing_app:mailing_create' %}" class="add-recipient-btn">Создать рассылку</a>  <!-- Исправил ссылку -->
    </div>

    <div class="mailing-table">
        <div class="table-header">
            <div>Первая отправка</div>
            <div>Окончание</div>
            <div>Статус</div>
            <div>Сообщение</div>
            <div>Получатели</div>
            <div>Действия</div>
        </div>

        {% for mailing in mailings %}
        <div class="table-row">
            <div class="table-cell" data-label="Первая отправка">
                <a href="{% url 'mailing_app:mailing_detail' mailing.pk %}" class="recipient-name-link">
                    {{ mailing.first_sending|date:"d.m.Y H:i" }}
                </a>
            </div>
            <div class="table-cell" data-label="Окончание">
                {{ mailing.finish_sending|date:"d.m.Y H:i"|default:"Не установлено" }}
            </div>
            <div class="table-cell" data-label="Статус">
                <span class="status-{{ mailing.status }}">{{ mailing.status }}</span>
            </div>
            <div class="table-cell" data-label="Сообщение">
                {% if mailing.message %}
                    {{ mailing.message.subject|default:mailing.message.body|truncatechars:25 }}
                {% else %}
                    <span class="no-recipients">Нет сообщения</span>
                {% endif %}
            </div>
            <div class="table-cell" data-label="Получатели">
                {% for recipient in mailing.recipients.all %}
                    <span class="recipient-tag">{{ recipient.name }}</span>
                {% empty %}
                    <span class="no-recipients">Нет получателей</span>
                {% endfor %}
            </div>
            {% if user == mailing.owner %}
            <div class="table-cell" data-label="Действия">
                <div class="mailing-actions">
                    <a href="{% url 'mailing_app:mailing_update' mailing.pk %}" class="mailing-edit-btn">Редактировать</a>
                    <a href="{% url 'mailing_app:mailing_delete' mailing.pk %}" class="mailing-delete-btn">Удалить</a>
                </div>
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    <div style="text-align: center;">
        <a href="{% url 'mailing_app:main_menu' %}" class="back-btn">Назад в главное меню</a>
    </div>
</div>
{% endblock %}